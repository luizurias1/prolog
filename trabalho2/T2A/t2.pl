
:- dynamic(nome/1).
nome('Suzana Vieira').
nome('Mary Jane').
nome('Pablo Monte').
nome('Lucifer Petry').
nome('Bruce Wayne').
nome('Oliver Queen').
nome('Natasha Romanov').
nome('Logan Silva').
nome('Silva e Silva').
nome('Barry Allen').

:- dynamic(nasc/4).
nasc('Bruce Wayne', 22, 02, 1939).
nasc('Suzana Vieira', 10, 20, 1959).
nasc('Mary Jane', 15, 07, 1950).
nasc('Lucifer Petry', 06, 06, 1966).
nasc('Oliver Queen', 15, 10, 1979).
nasc('Natasha Romanov', 10, 06, 1978).
nasc('Logan Silva', 29, 12, 1969).
nasc('Silva e Silva', 22, 02, 1982).
nasc('Barry Allen', 22, 02, 1986).
nasc('Pablo Monte', 25, 11, 1982).

:- dynamic(professor/1).
professor('Joao Tenorio').
professor('Aline Vemcurt').
professor('Tereza Montegrande').
professor('Clorisvaldo de Aumeida').
professor('Pedro Pedrozo').

:- dynamic(orientou/2).
orientou('Joao Tenorio', 'Barry Allen').
orientou('Tereza Montegrande', 'Pablo Monte').
orientou('Tereza Montegrande', 'Suzana Vieira').
orientou('Clorisvaldo de Aumeida', 'Mary Jane').
orientou('Joao Tenorio', 'Lucifer Petry').
orientou('Joao Tenorio', 'Bruce Wayne').
orientou('Clorisvaldo de Aumeida', 'Oliver Queen').
orientou('Joao Tenorio', 'Natasha Romanov').
orientou('Pedro Pedrozo', 'Logan Silva').
orientou('Pedro Pedrozo', 'Silva e Silva').

:- dynamic(curso/1).
curso('Ciencias da Computucao').
curso('Letras').
curso('Numeros').
curso('Artes Marciais').
curso('Sistemas').
curso('Engenharia Mecanica').

:- dynamic(cursou/4).
cursou('Bruce Wayne', 'Artes Marciais', 1980, 1985).
cursou('Oliver Queen', 'Artes Marciais', 1982, 1987).
cursou('Suzana Vieira', 'Letras', 1982, 1987).
cursou('Mary Jane', 'Engenharia Mecanica', 1990, 2000).
cursou('Pablo Monte', 'Numeros', 1990, 1994).
cursou('Pablo Monte', 'Sistemas', 1995, 2000).
cursou('Lucifer Petry', 'Letras', 1966, 1972).
cursou('Natasha Romanov', 'Ciencias da Computucao', 1995, 2000).
cursou('Logan Silva', 'Artes Marciais', 1970, 1977).
cursou('Silva e Silva', 'Numeros', 2000, 2006).
cursou('Barry Allen', 'Sistemas', 1997, 2001).

:- dynamic(empresa/1).
empresa('LABSEC').
empresa('UFSC').
empresa('Google').
empresa('Microsoft').
empresa('Wayne Enterprises').
empresa('Queen Industries').
empresa('Samsumg').

:- dynamic(telefone/1).
telefone(33333333).
telefone(44444444).
telefone(76547636).
telefone(87568444).
telefone(87468923).
telefone(98769867).
telefone(49654348).
telefone(87565439).
telefone(98766543).
telefone(35899864).

:- dynamic(cidade/1).
cidade('Florianopolis').
cidade('Gotham').
cidade('Starling').
cidade('NewYork').
cidade('Central').

:- dynamic(telefonede/2).
telefonede('Suzana Vieira', 33333333).
telefonede('Pablo Monte', 44444444).
telefonede('Bruce Wayne', 76547636).
telefonede('Natasha Romanov', 87468923).
telefonede('Barry Allen', 98769867).
telefonede('Silva e Silva', 49654348).
telefonede('Oliver Queen', 87468923).
telefonede('Lucifer Petry', 87565439).
telefonede('Mary Jane', 98766543).
telefonede('Logan Silva', 35899864).

:- dynamic(cidadede/2).
cidadede('Pablo Monte', 'Florianopolis').
cidadede('Logan Silva', 'Florianopolis').
cidadede('Suzana Vieira', 'Central').
cidadede('Bruce Wayne', 'Gotham').
cidadede('Natasha Romanov', 'NewYork').
cidadede('Barry Allen', 'Central').
cidadede('Silva e Silva', 'NewYork').
cidadede('Oliver Queen', 'Starling').
cidadede('Lucifer Petry', 'Florianopolis').
cidadede('Mary Jane', 'Central').

:- dynamic(trabalhou/2).
trabalhou('Pablo Monte', 'LABSEC').
trabalhou('Pablo Monte', 'Microsoft').
trabalhou('Pablo Monte', 'Google').
trabalhou('Logan Silva', 'Google').
trabalhou('Suzana Vieira', 'Google').
trabalhou('Bruce Wayne', 'Wayne Enterprises').
trabalhou('Natasha Romanov', 'Queen Industries').
trabalhou('Barry Allen', 'UFSC').
trabalhou('Silva e Silva', 'UFSC').
trabalhou('Oliver Queen', 'Queen Industries').
trabalhou('Lucifer Petry', 'LABSEC').
trabalhou('Mary Jane', 'Samsumg').

:- dynamic(referencia/2).
referencia('Oliver Queen', 'Bruce Wayne').
referencia('Logan Silva', 'Bruce Wayne').
referencia('Silva e Silva', 'Pablo Monte').
referencia('Lucas Silva', 'Pablo Monte').
referencia('Mary Jane', 'Pablo Monte').
referencia('Silva e Silva', 'Lucifer Petry').
referencia('Mary Jane', 'Barry Allen').
referencia('Natasha Romanov', 'Barry Allen').
referencia('Natasha Romanov', 'Pablo Monte').
referencia('Natasha Romanov', 'Mary Jane').

:- dynamic(inst/1).
inst('UFSC').
inst('UDESC').
inst('UNISUL').
inst('UFSM').
inst('QueenSchool').
inst('Harvard').
inst('Vida').

:- dynamic(estudouEm/2).
estudouEm('Pablo Monte', 'UNISUL').
estudouEm('Logan Silva', 'UNISUL').
estudouEm('Suzana Vieira', 'UNISUL').
estudouEm('Suzana Vieira', 'UFSC').
estudouEm('Mary Jane', 'UDESC').
estudouEm('Lucifer Petry', 'UFSM').
estudouEm('Oliver Queen', 'QueenSchool').
estudouEm('Silva e Silva', 'Vida').
estudouEm('Barry Allen', 'Harvard').
estudouEm('Natasha Romanov', 'UFSC').

:- dynamic(xp/5).
xp('Pablo Monte', 'Facilitador', 'LABSEC', 2001, 2007).
xp('Pablo Monte', 'Testador', 'Microsoft', 2008, 2010).
xp('Pablo Monte', 'Gerente Organizacional dos Facilitadores', 'Google', 2011, 2014).
xp('Logan Silva', 'Programador', 'Google', 2000, 2009).
xp('Logan Silva', 'Fisiculturista', 'UFSC', 2010, 2015).
xp('Suzana Vieira', 'Secretaria', 'Google', 1980, 2012).
xp('Bruce Wayne', 'BilionÃ¡rio', 'Wayne Enterprises', 2010, 2015).
xp('Natasha Romanov', 'Arquiteta de Projetos', 'Queen Industries', 1997, 2014).
xp('Barry Allen', 'Facilitador', 'UFSC', 2000, 2009).
xp('Silva e Silva', 'Facilitador', 'UFSC', 2001, 2008).
xp('Oliver Queen', 'CEO', 'Queen Industries', 2013, 2014).
xp('Lucifer Petry', 'Comentarista', 'LABSEC', 2005, 2007).
xp('Mary Jane', 'Diretora de Marketing', 'Microsoft', 1970, 2005).


listlen([ ], 0).
listlen([H|T], N) :- listlen(T, N1), N is N1 + 1.
conta(P, Contador):-findall(1, P, Lista), listlen(Lista, Contador).
acumula([ ], 0).
acumula([H|T], N):-acumula(T, N1), N is N1 + H.
acumulaMedia([ ], 0).
acumulaMedia([H|T], K):-acumulaMedia(T, K1), totalEstudado(H,L), K is K1 + L.
max([X],X).
max([X|Xs],X) :- max(Xs,Y), X >= Y.
max([X|Xs],N) :- max(Xs,N), N > X.
inserir(Elem, Lista, [Elem|Lista]). 

%Q1
qualTelefone(X,Y):-nome(X), telefone(Y), telefonede(X,Y).

%Q2
pessoasNaCidade(X,Y):-cidade(X), nome(Y), cidadede(Y,X).

%Q3
idade(X,Y):- nome(X), nasc(X,_,_,W), Y is 2015-W.

%Q4
maisDe30(Y):- nome(Y), idade(Y, X), X >= 30.

%Q5
cursos(X,Y):-nome(X), curso(Y), cursou(X,Y,_,_).

%Q6
orientador(X,Y):-nome(X), professor(Y), orientou(Y,X).

%Q7
colegas(X,Y):-nome(X), nome(Y), (cursou(X,O,_,_), cursou(Y,W,_,_), O==W, X\==Y; trabalhou(X,L), trabalhou(Y,U), L==U, X\==Y).

%Q8
naoCitados(X):-nome(X), referencia(_,X), \+colegas(X, Z).

%Q9e23
numeroDeColegas(X,R):-nome(X), conta(colegas(X,Y), R).

%Q10
quantidadeInst(X,Y):-inst(X), conta(estudouEm(W,X),Y).

%Q11
maisDe5(X):-nome(X), xp(X,_,_,W,Q), K is (Q-W), K >= 5.

%Q12
tempoDeEstudo(X,Y,T):-nome(X), cursou(X,Y,W,H), T is (H-W).

%Q13
totalEstudado(X,R):-nome(X), findall(T,tempoDeEstudo(X,_,T),Lista), acumula(Lista, R).

%Q14
mediaTotal(X):-findall(H, nome(H), Lista), acumulaMedia(Lista, F), conta(cursou(A,_,_,_), T), X is F/T.

%Q15
referenciados(X):-findall(G, referencia(_,G), X).

%Q16
estudaramEm(X, Lista):-findall(H, estudouEm(H,X), Lista).

%Q17
temposCursos(X, ListaT, ListaC):-findall(T, tempoDeEstudo(X,_,T), ListaT), findall(C, tempoDeEstudo(X,C,_), ListaC).
cursoMaisLongo(X, C):-temposCursos(X, H,_), max(H,J), tempoDeEstudo(X, C, J).

%Q18
pessoasNaInst(Lista):-findall(K, quantidadeInst(_,K), Lista).
maisPessoasInst(X):-pessoasNaInst(L), max(L, T), quantidadeInst(X, T).

%Q19
tempoNaEmpresa(X, E, R):-nome(X), empresa(E), xp(X,_,E,I,F), R is (F-I).
temposTrabalhadosEm(X, R):-empresa(X), findall(N, tempoNaEmpresa(_,X,N), ListaT), acumula(ListaT, R).
empresaMaiorTempo(X):-findall(U, temposTrabalhadosEm(_,U), Lista), max(Lista, X).
retornaEmpresa(X):-empresaMaiorTempo(Y), temposTrabalhadosEm(X,R), Y==R.

%Q20
tempoNoCargo(R):-findall(T, tempoNaEmpresa(_,_,T), Lista), max(Lista, R).
maisTempoFicou(P):-tempoNoCargo(R), tempoNaEmpresa(C,E,R), xp(C,X,E,I,F), curriculo(C, P).

curriculo(Nome, Curriculo):- 

findall( {Dia, Mes, Ano}, nasc(Nome, Dia, Mes, Ano), Nascimento),
cidadede(Nome, Cidade), 
telefonede(Nome, Telefone), 
findall( {Curso, Inicio, Fim}, cursou(Nome, Curso, Inicio, Fim), Cursos), 
findall( {Cargo, Empresa, I, F}, xp(Nome, Cargo, Empresa, I, F), XP), 

inserir(Cursos, XP, Lista1), 
inserir(Telefone, Lista1, Lista2), 
inserir(Cidade, Lista2, Lista3), 
inserir(Nascimento, Lista3, Lista4),
inserir(Nome, Lista4, Curriculo).

%Q21
maisR(N, A):- nome(A), conta(referencia(_,A), N).
maisRe(R):-findall(N, maisR(N,X), Lista), max(Lista, R).
maisRef(O):- maisRe(R), maisR(R,P), curriculo(P, O).

%Q22
colegasReferenciados(X, Y):-colegas(X,Y), referencia(_,Y).
todosCR(X, Y):- nome(X), conta(colegasReferenciados(X, Z), Y).
quantidadeCR(F):-findall(Y, todosCR(X,Y), Lista), max(Lista, F).
maisColegasReferenciados(C):- quantidadeCR(F), todosCR(X, F), curriculo(X, C).

%Q24
maxRC(C):- findall(N, numeroDeColegas(X,  N), Lista), max(Lista, C).
maisRC(C):- maxRC(L), numeroDeColegas(X, L), curriculo(X, C).

%Q25
maxVelho(R):- findall(D, idade(X, D), Lista), max(Lista, R).
maisVelho(R):- maxVelho(F), idade(R, F).


%--------------------- PART TWO ------------------------

%Q1

gravarXP:-tell('novosXP.pl'), listing(xp), told.
inserirXP(NOME, CARGO, EMPRESA, INICIO, FIM):-assert(xp(NOME, CARGO, EMPRESA, INICIO, FIM)), gravarXP, !.

gravarNasc:-tell('novosNasc.pl'), listing(nasc), told.
inserirNasc(Nome, DIA, MES, ANO):-assert(nasc(Nome, DIA, MES, ANO)), gravarNasc, !.

gravarNome:-tell('novosNomes.pl'), listing(nome), told.
inserirNome(Nome):-assert(nome(Nome)), gravarNome, !.

gravarTelefone:- tell('novosTelefones.pl'),listing(telefonede), told.
inserirTelefone(Nome, TEl):- nome(Nome), assert(telefonede(Nome,TEl)), gravarTelefone, !.

inserirCurso(Nome,Curso,Inicio,Fim):- nome(Nome), assert(cursou(Nome,Curso,Inicio,Fim)), gravarCurso,!.
gravarCurso:- tell('novosCursou.pl'), listing(cursou), told.

inserirCidade(NOME,CIDADE):-nome(NOME), cidade(CIDADE),assert(cidadede(NOME,CIDADE)), gravarCidade, !.

%Q2

removerTelefone(NOME):-retract(telefonede(NOME,T)), gravarTelefone.
removerCurso(NOME, CURSO):-retract(cursou(NOME,CURSO,_,_)), gravarCurso.
removerNasc(NOME):-retract(nasc(NOME,_,_,_)), gravarNasc.
removerCidade(NOME):-retract(cidadede(NOME, C)), gravarCidade.

%Q3

gravarCidade:-tell('novasCidades.pl'), listing(cidadede), told.
imprimirCidade(NOME):- write('Nome: '), write(NOME), nl, write('Cidade: '), cidadede(NOME, U), write(U).
alterarCidade(NOME):-nome(NOME), imprimirCidade(NOME), nl, removerCidade(NOME), write('Nova Cidade\n'), read(NovaCidade), assert(cidadede(NOME, NovaCidade)), gravarCidade,!.

imprimirTelefone(NOME):-write('Nome: '), write(NOME), nl, write('Telefone: '), telefonede(NOME,U), write(U).
alterarTelefone(NOME):-nome(NOME), imprimirTelefone(NOME), nl, removerTelefone(NOME), write('Novo Telefone\n'), read(NovoTelefone), assert(telefonede(NOME, NovoTelefone)), gravarTelefone,!.

%Q4

imprimirBorda:-write('--------------------------------------------------'), nl.
imprimirNasc(NOME):-nl, write('Data de Nascimento: '), nasc(NOME, DIA, MES, ANO), write(DIA), write('/'), write(MES), write('/'), write(ANO).
imprimirXP(NOME):-nl, write('Experiencias: '), nl, xp(NOME, CARGO, EMPRESA, INICIO, FIM), write('Cargo: '), write(CARGO), nl,  write('Empresa: '), write(EMPRESA), nl,  write('Trabalhou de '),
write(INICIO), write(' atÃ© '), write(FIM), nl.
imprimirCid(NOME):-nl, cidadede(NOME, CIDADE), write('Cidade: '), write(CIDADE), nl.
imprimirNome(NOME):-nl, write('Nome: '), write(NOME), nl.
imprimirFormacao(NOME):-nl, cursou(NOME,CURSO,INICIO,FIM), write('Cursou: '), write(CURSO), write('	de '), write(INICIO), write(' a '), write(FIM).
imprimirTel(NOME):-nl, write('Contato: '), telefonede(NOME, TEL), write(TEL), nl.

%----- consulta pelo nome -----
imprimirCurriculo(NOME):-nl, imprimirBorda, imprimirNome(NOME), imprimirNasc(NOME), imprimirCid(NOME), imprimirTel(NOME), imprimirFormacao(NOME), nl, imprimirXP(NOME), nl, imprimirBorda.
%----- consulta pela cidade -----
imprimirCurriculoCidade(CIDADE):-cidade(CIDADE), cidadede(NOME,CIDADE), nl, imprimirBorda, imprimirNome(NOME), 
imprimirNasc(NOME), imprimirCid(NOME), imprimirTel(NOME), imprimirFormacao(NOME), nl, imprimirXP(NOME), nl, imprimirBorda.
%----- consulta pela instituicao ----
imprimirCurriculoInst(INST):-inst(INST), estudouEm(NOME,INST), nl, imprimirBorda, imprimirNome(NOME), 
imprimirNasc(NOME), imprimirCid(NOME), imprimirTel(NOME), imprimirFormacao(NOME), nl, imprimirXP(NOME), nl, imprimirBorda.
%----- consulta pela empresa -----
imprimirCurriculoEmpresa(EMPRESA):-empresa(EMPRESA), trabalhou(NOME,EMPRESA), nl, imprimirBorda, imprimirNome(NOME), imprimirNasc(NOME),
imprimirCid(NOME), imprimirTel(NOME), imprimirFormacao(NOME), nl, imprimirXP(NOME), nl, imprimirBorda.
%----- pessoas de florianopolis com mais de 20 anos -----
fromFlorianopolis(NOME):- cidadede(NOME,CIDADE), CIDADE='Florianopolis'.
maiorDe20(NOME):-idade(NOME, VALOR), VALOR>=20.
consultaDupla:-fromFlorianopolis(NOME), maiorDe20(NOME), imprimirCurriculo(NOME).
